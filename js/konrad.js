// koffee 1.4.0

/*
000   000   0000000   000   000  00000000    0000000   0000000
000  000   000   000  0000  000  000   000  000   000  000   000
0000000    000   000  000 0 000  0000000    000000000  000   000
000  000   000   000  000  0000  000   000  000   000  000   000
000   000   0000000   000   000  000   000  000   000  0000000
 */
var _, actions, argDir, args, build, cmd, colors, config, dirty, dotGit, fs, gitcount, gitup, j, klog, len, noon, opt, optall, pkg, pretty, ref, ref1, runcmd, should, slash, status, walk, watch, wlk;

ref = require('kxk'), colors = ref.colors, slash = ref.slash, args = ref.args, noon = ref.noon, fs = ref.fs, klog = ref.klog, _ = ref._;

argDir = require('./argdir');

build = require('./build');

config = require('./config');

pretty = require('./pretty');

runcmd = require('./runcmd');

should = require('./should');

status = require('./status');

watch = require('./watch');

walk = require('./walk');

pkg = require(__dirname + "/../package");

args = args.init("arguments  depend on options                            **\nrun        build dirty or missing targets in dir        false\nrebuild    rebuild all targets in dir                   false  -R\nwatch      watch directory for changes                  false\ninfo       show build status of dir                     false\nbump       bump package.* version [major|minor|patch]   false\nbuild      make package                                 false  -m\ndiff       show git diff of file/dir                    false\nstatus     show git status of file/dir                  false\nfetch      fetch and show git status of file/dir        false\ncommit     add, commit and push [msg]                   false\nupdate     update npm packages                          false\npublish    bump, commit & publish to npm [msg]          false\ntest       run tests                                    false\nverbose    log more                                     false\nquiet      log nothing                                  false\ndebug      log debug                                    false  -D\nlogtime    log with time                                true", {
    pkg: pkg
});

actions = ['bump', 'build', 'commit', 'publish', 'update', 'test', 'watch', 'run', 'rebuild', 'info', 'status', 'fetch', 'diff'];

if (!actions.map(function(a) {
    return args[a];
}).reduce(function(acc, val) {
    return acc || val;
})) {
    args.run = true;
}

opt = noon.parse("coffee  . ext js   . map true . replace .. /coffee/ /js/ .. ^coffee/ js/ \nkoffee  . ext js   . map true . replace .. /coffee/ /js/ .. ^coffee/ js/ \nnoon    . ext json\njson    . ext noon . filter  .. package.json$\nstyl    . ext css  . replace .. /style/ /css/ .. /styl/ /js/css/\npug     . ext html . replace .. /pug/ /js/");

opt.ignore = [/gulpfile.coffee$/, /Gruntfile.coffee$/, /\.konrad\.noon$/, /menu.noon$/];

wlk = {
    ignore: [/node_modules$/, /bower_components$/, /\/img$/, /\/\..+$/, /\.git$/, /\.app$/, /.*-x64$/, /.*-ia32$/, /\/?inno$/, /\/?js$/]
};

dirty = function(sourceFile, targetFile) {
    var ss, ts;
    if (!fs.existsSync(targetFile)) {
        return true;
    }
    ss = fs.statSync(sourceFile);
    ts = fs.statSync(targetFile);
    return ss.mtime.getTime() > ts.mtime.getTime();
};

if (args.info) {
    console.log('‚óã‚óè info'.gray);
    walk(wlk, opt, function(sourceFile, targetFile) {
        if (args.verbose) {
            console.log("source: " + sourceFile + " target: " + targetFile);
        }
        if (dirty(sourceFile, targetFile)) {
            return console.log(pretty.filePath(_.padEnd(slash.relative(sourceFile, argDir()), 40), colors.yellow), " ‚ñ∫ ".red.dim, pretty.filePath(slash.relative(targetFile, argDir()), colors.red));
        } else if (args.verbose) {
            return console.log(pretty.filePath(_.padEnd(slash.relative(sourceFile, argDir()), 40), colors.magenta), " ‚ñ∫ ".green.dim, pretty.filePath(slash.relative(targetFile, argDir()), colors.green));
        }
    });
}

if (args.diff) {
    args.status = true;
}

if (args.status || args.fetch) {
    optall = _.defaults(opt, {
        all: true
    });
    gitcount = 0;
    walk(wlk, optall, function(sourceFile, targetFile) {
        var i, j, len, ref1;
        if (!targetFile) {
            if (slash.basename(sourceFile) === '.git') {
                if (args.fetch) {
                    status.gitFetch(sourceFile);
                } else {
                    status.gitStatus(sourceFile);
                }
                gitcount += 1;
            }
            if (slash.dirExists(sourceFile)) {
                ref1 = opt.ignore;
                for (j = 0, len = ref1.length; j < len; j++) {
                    i = ref1[j];
                    if ((i != null ? i.test : void 0) != null) {
                        if (i.test(sourceFile)) {
                            return false;
                        }
                    } else {
                        klog('ignore?', i);
                    }
                }
            }
        }
        return true;
    });
    if (!gitcount) {
        gitup = slash.parse(argDir());
        while (gitup.base) {
            dotGit = slash.join(gitup.dir, '.git');
            if (fs.existsSync(dotGit)) {
                if (args.fetch) {
                    status.gitFetch(dotGit);
                } else {
                    status.gitStatus(dotGit);
                }
                break;
            }
            gitup = slash.parse(gitup.dir);
        }
    }
}

if (args.run || args.rebuild) {
    if (!args.quiet) {
        console.log('üîßüîß ' + (args.rebuild && 'rebuild' || 'run').gray);
    }
    walk(wlk, opt, function(sourceFile, targetFile) {
        var isDirty, src, tgt;
        if (targetFile) {
            isDirty = dirty(sourceFile, targetFile);
            if (args.rebuild || isDirty) {
                src = pretty.filePath(_.padEnd(slash.relative(sourceFile, argDir()), 40), isDirty && colors.red || colors.yellow);
                tgt = pretty.filePath(slash.relative(targetFile, argDir()), colors.green);
                if (!args.quiet) {
                    console.log(src, "üîß  ", tgt);
                }
                return build(sourceFile, opt, function(sourceFile, targetFile) {
                    var o;
                    if (!targetFile) {
                        process.exit(1);
                    }
                    o = config.obj(targetFile, opt);
                    if (should('browserify', o, targetFile)) {
                        console.log(pretty.filePath(_.padEnd(slash.relative(o.browserify.main, argDir()), 40), colors.yellow), "üîß  ", pretty.filePath(slash.relative(o.browserify.out, argDir()), colors.blue));
                        return runcmd('browserify', o.browserify.main + " " + o.browserify.out, config.path('browserify', slash.resolve(targetFile), opt));
                    }
                });
            }
        }
    });
}

ref1 = ['update', 'bump', 'build', 'commit', 'publish', 'test'];
for (j = 0, len = ref1.length; j < len; j++) {
    cmd = ref1[j];
    if (args[cmd]) {
        if (!runcmd(cmd, args["arguments"].join(' '), process.cwd())) {
            process.exit(1);
            break;
        }
        if (args.verbose) {
            console.log('üîß  done'.gray);
        }
        if (args["arguments"] && (cmd === 'commit' || cmd === 'bump' || cmd === 'build')) {
            break;
        }
    }
}

if (args.watch) {
    watch(wlk, opt);
} else if (cmd === 'build') {
    process.exit(0);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia29ucmFkLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQTs7QUFRQSxNQUE2QyxPQUFBLENBQVEsS0FBUixDQUE3QyxFQUFFLG1CQUFGLEVBQVUsaUJBQVYsRUFBaUIsZUFBakIsRUFBdUIsZUFBdkIsRUFBNkIsV0FBN0IsRUFBaUMsZUFBakMsRUFBdUM7O0FBRXZDLE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjs7QUFDVCxLQUFBLEdBQVMsT0FBQSxDQUFRLFNBQVI7O0FBQ1QsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSOztBQUNULE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjs7QUFDVCxNQUFBLEdBQVMsT0FBQSxDQUFRLFVBQVI7O0FBQ1QsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSOztBQUNULE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjs7QUFDVCxLQUFBLEdBQVMsT0FBQSxDQUFRLFNBQVI7O0FBQ1QsSUFBQSxHQUFTLE9BQUEsQ0FBUSxRQUFSOztBQUNULEdBQUEsR0FBUyxPQUFBLENBQVcsU0FBRCxHQUFXLGFBQXJCOztBQUVULElBQUEsR0FBTyxJQUFJLENBQUMsSUFBTCxDQUFVLHNuQ0FBVixFQW1CRTtJQUFBLEdBQUEsRUFBSSxHQUFKO0NBbkJGOztBQXFCUCxPQUFBLEdBQVUsQ0FBQyxNQUFELEVBQVEsT0FBUixFQUFnQixRQUFoQixFQUF5QixTQUF6QixFQUFtQyxRQUFuQyxFQUE0QyxNQUE1QyxFQUFtRCxPQUFuRCxFQUEyRCxLQUEzRCxFQUFpRSxTQUFqRSxFQUEyRSxNQUEzRSxFQUFrRixRQUFsRixFQUEyRixPQUEzRixFQUFtRyxNQUFuRzs7QUFFVixJQUFHLENBQUksT0FBTyxDQUFDLEdBQVIsQ0FBWSxTQUFDLENBQUQ7V0FBTyxJQUFLLENBQUEsQ0FBQTtBQUFaLENBQVosQ0FBMkIsQ0FBQyxNQUE1QixDQUFtQyxTQUFDLEdBQUQsRUFBSyxH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QixDQUF0QjtBQUNJLGtCQURKO1NBUko7O0FBRko7O0FBYUEsSUFBRyxJQUFJLENBQUMsS0FBUjtJQUNJLEtBQUEsQ0FBTSxHQUFOLEVBQVcsR0FBWCxFQURKO0NBQUEsTUFFSyxJQUFHLEdBQUEsS0FBUSxPQUFYO0lBQ0QsT0FBTyxDQUFDLElBQVIsQ0FBYSxDQUFiLEVBREMiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwXG4wMDAgIDAwMCAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgMDAwXG4wMDAgIDAwMCAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMFxuIyMjXG5cbnsgY29sb3JzLCBzbGFzaCwgYXJncywgbm9vbiwgZnMsIGtsb2csIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuYXJnRGlyID0gcmVxdWlyZSAnLi9hcmdkaXInXG5idWlsZCAgPSByZXF1aXJlICcuL2J1aWxkJ1xuY29uZmlnID0gcmVxdWlyZSAnLi9jb25maWcnXG5wcmV0dHkgPSByZXF1aXJlICcuL3ByZXR0eSdcbnJ1bmNtZCA9IHJlcXVpcmUgJy4vcnVuY21kJ1xuc2hvdWxkID0gcmVxdWlyZSAnLi9zaG91bGQnXG5zdGF0dXMgPSByZXF1aXJlICcuL3N0YXR1cydcbndhdGNoICA9IHJlcXVpcmUgJy4vd2F0Y2gnXG53YWxrICAgPSByZXF1aXJlICcuL3dhbGsnXG5wa2cgICAgPSByZXF1aXJlIFwiI3tfX2Rpcm5hbWV9Ly4uL3BhY2thZ2VcIlxuXG5hcmdzID0gYXJncy5pbml0IFwiXCJcIlxuICAgIGFyZ3VtZW50cyAgZGVwZW5kIG9uIG9wdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgKipcbiAgICBydW4gICAgICAgIGJ1aWxkIGRpcnR5IG9yIG1pc3NpbmcgdGFyZ2V0cyBpbiBkaXIgICAgICAgIGZhbHNlXG4gICAgcmVidWlsZCAgICByZWJ1aWxkIGFsbCB0YXJnZXRzIGluIGRpciAgICAgICAgICAgICAgICAgICBmYWxzZSAgLVJcbiAgICB3YXRjaCAgICAgIHdhdGNoIGRpcmVjdG9yeSBmb3IgY2hhbmdlcyAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgaW5mbyAgICAgICBzaG93IGJ1aWxkIHN0YXR1cyBvZiBkaXIgICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIGJ1bXAgICAgICAgYnVtcCBwYWNrYWdlLiogdmVyc2lvbiBbbWFqb3J8bWlub3J8cGF0Y2hdICAgZmFsc2VcbiAgICBidWlsZCAgICAgIG1ha2UgcGFja2FnZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlICAtbVxuICAgIGRpZmYgICAgICAgc2hvdyBnaXQgZGlmZiBvZiBmaWxlL2RpciAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICBzdGF0dXMgICAgIHNob3cgZ2l0IHN0YXR1cyBvZiBmaWxlL2RpciAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgZmV0Y2ggICAgICBmZXRjaCBhbmQgc2hvdyBnaXQgc3RhdHVzIG9mIGZpbGUvZGlyICAgICAgICBmYWxzZVxuICAgIGNvbW1pdCAgICAgYWRkLCBjb21taXQgYW5kIHB1c2ggW21zZ10gICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICB1cGRhdGUgICAgIHVwZGF0ZSBucG0gcGFja2FnZXMgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgcHVibGlzaCAgICBidW1wLCBjb21taXQgJiBwdWJsaXNoIHRvIG5wbSBbbXNnXSAgICAgICAgICBmYWxzZVxuICAgIHRlc3QgICAgICAgcnVuIHRlc3RzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICB2ZXJib3NlICAgIGxvZyBtb3JlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgcXVpZXQgICAgICBsb2cgbm90aGluZyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIGRlYnVnICAgICAgbG9nIGRlYnVnICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UgIC1EXG4gICAgbG9ndGltZSAgICBsb2cgd2l0aCB0aW1lICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgXCJcIlwiLCBwa2c6cGtnXG5cbmFjdGlvbnMgPSBbJ2J1bXAnICdidWlsZCcgJ2NvbW1pdCcgJ3B1Ymxpc2gnICd1cGRhdGUnICd0ZXN0JyAnd2F0Y2gnICdydW4nICdyZWJ1aWxkJyAnaW5mbycgJ3N0YXR1cycgJ2ZldGNoJyAnZGlmZiddXG5cbmlmIG5vdCBhY3Rpb25zLm1hcCgoYSkgLT4gYXJnc1thXSkucmVkdWNlKChhY2MsdmFsKSAtPiBhY2Mgb3IgdmFsKVxuICAgIGFyZ3MucnVuID0gdHJ1ZSAjIG1ha2VzIHJ1biB0aGUgZGVmYXVsdCBhY3Rpb24gaWYgbm8gb3RoZXIgYWN0aW9uIGlzIHNldFxuICAgIFxuIyAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAwMCAgIDAwMDAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICAgIDAwMFxuIyAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwMDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgICAgICAwMDBcbiMgMDAwMDAwMCAgICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDBcblxub3B0ID0gbm9vbi5wYXJzZSBcIlwiXCJcbmNvZmZlZSAgLiBleHQganMgICAuIG1hcCB0cnVlIC4gcmVwbGFjZSAuLiAvY29mZmVlLyAvanMvIC4uIF5jb2ZmZWUvIGpzLyBcbmtvZmZlZSAgLiBleHQganMgICAuIG1hcCB0cnVlIC4gcmVwbGFjZSAuLiAvY29mZmVlLyAvanMvIC4uIF5jb2ZmZWUvIGpzLyBcbm5vb24gICAgLiBleHQganNvblxuanNvbiAgICAuIGV4dCBub29uIC4gZmlsdGVyICAuLiBwYWNrYWdlLmpzb24kXG5zdHlsICAgIC4gZXh0IGNzcyAgLiByZXBsYWNlIC4uIC9zdHlsZS8gL2Nzcy8gLi4gL3N0eWwvIC9qcy9jc3MvXG5wdWcgICAgIC4gZXh0IGh0bWwgLiByZXBsYWNlIC4uIC9wdWcvIC9qcy9cblwiXCJcIlxuXG4jIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwMFxuIyAwMDAgIDAwMCAgICAgICAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwXG4jIDAwMCAgMDAwICAwMDAwICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwXG4jIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDBcbiMgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwXG5cbm9wdC5pZ25vcmUgPSBbXG4gICAgL2d1bHBmaWxlLmNvZmZlZSQvXG4gICAgL0dydW50ZmlsZS5jb2ZmZWUkL1xuICAgIC9cXC5rb25yYWRcXC5ub29uJC9cbiAgICAvbWVudS5ub29uJC9cbl1cblxud2xrID1cbiAgICBpZ25vcmU6IFtcbiAgICAgICAgL25vZGVfbW9kdWxlcyQvXG4gICAgICAgIC9ib3dlcl9jb21wb25lbnRzJC9cbiAgICAgICAgL1xcL2ltZyQvXG4gICAgICAgIC9cXC9cXC4uKyQvXG4gICAgICAgIC9cXC5naXQkL1xuICAgICAgICAvXFwuYXBwJC9cbiAgICAgICAgLy4qLXg2NCQvXG4gICAgICAgIC8uKi1pYTMyJC9cbiAgICAgICAgL1xcLz9pbm5vJC9cbiAgICAgICAgL1xcLz9qcyQvXG4gICAgXVxuXG4jIDAwMDAwMDAgICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwXG4jIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgIDAwMCAwMDBcbiMgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgICAgICAgMDAwICAgICAgIDAwMDAwXG4jIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwXG4jIDAwMDAwMDAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwXG5cbmRpcnR5ID0gKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUpIC0+XG4gICAgXG4gICAgaWYgbm90IGZzLmV4aXN0c1N5bmMgdGFyZ2V0RmlsZSB0aGVuIHJldHVybiB0cnVlXG4gICAgc3MgPSBmcy5zdGF0U3luYyBzb3VyY2VGaWxlXG4gICAgdHMgPSBmcy5zdGF0U3luYyB0YXJnZXRGaWxlXG4gICAgc3MubXRpbWUuZ2V0VGltZSgpID4gdHMubXRpbWUuZ2V0VGltZSgpXG5cbiMgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMFxuIyAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuIyAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwICAgIDAwMCAgIDAwMFxuIyAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuIyAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAwMDAwXG5cbmlmIGFyZ3MuaW5mb1xuXG4gICAgbG9nICfil4vil48gaW5mbycuZ3JheVxuXG4gICAgd2FsayB3bGssIG9wdCwgKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUpIC0+XG5cbiAgICAgICAgbG9nIFwic291cmNlOiAje3NvdXJjZUZpbGV9IHRhcmdldDogI3t0YXJnZXRGaWxlfVwiIGlmIGFyZ3MudmVyYm9zZVxuICAgICAgICBpZiBkaXJ0eSBzb3VyY2VGaWxlLCB0YXJnZXRGaWxlXG4gICAgICAgICAgICBsb2cgcHJldHR5LmZpbGVQYXRoKF8ucGFkRW5kKHNsYXNoLnJlbGF0aXZlKHNvdXJjZUZpbGUsIGFyZ0RpcigpKSwgNDApLCBjb2xvcnMueWVsbG93KSwgXCIg4pa6IFwiLnJlZC5kaW0sIHByZXR0eS5maWxlUGF0aChzbGFzaC5yZWxhdGl2ZSh0YXJnZXRGaWxlLCBhcmdEaXIoKSksIGNvbG9ycy5yZWQpXG4gICAgICAgIGVsc2UgaWYgYXJncy52ZXJib3NlXG4gICAgICAgICAgICBsb2cgcHJldHR5LmZpbGVQYXRoKF8ucGFkRW5kKHNsYXNoLnJlbGF0aXZlKHNvdXJjZUZpbGUsIGFyZ0RpcigpKSwgNDApLCBjb2xvcnMubWFnZW50YSksIFwiIOKWuiBcIi5ncmVlbi5kaW0sIHByZXR0eS5maWxlUGF0aChzbGFzaC5yZWxhdGl2ZSh0YXJnZXRGaWxlLCBhcmdEaXIoKSksIGNvbG9ycy5ncmVlbilcblxuaWYgYXJncy5kaWZmXG4gICAgXG4gICAgYXJncy5zdGF0dXMgPSB0cnVlXG5cbiMga2xvZyBhcmdzXG4gICAgXG5pZiBhcmdzLnN0YXR1cyBvciBhcmdzLmZldGNoXG4gICAgXG4gICAgb3B0YWxsID0gXy5kZWZhdWx0cyBvcHQsIGFsbDogdHJ1ZVxuICAgIGdpdGNvdW50ID0gMFxuXG4gICAgd2FsayB3bGssIG9wdGFsbCwgKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUpIC0+XG5cbiAgICAgICAgaWYgbm90IHRhcmdldEZpbGVcblxuICAgICAgICAgICAgaWYgc2xhc2guYmFzZW5hbWUoc291cmNlRmlsZSkgPT0gJy5naXQnXG4gICAgICAgICAgICAgICAgaWYgYXJncy5mZXRjaFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXMuZ2l0RmV0Y2ggc291cmNlRmlsZVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzLmdpdFN0YXR1cyBzb3VyY2VGaWxlXG4gICAgICAgICAgICAgICAgZ2l0Y291bnQgKz0gMVxuXG4gICAgICAgICAgICBpZiBzbGFzaC5kaXJFeGlzdHMgc291cmNlRmlsZVxuICAgICAgICAgICAgICAgIGZvciBpIGluIG9wdC5pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgaWYgaT8udGVzdD9cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkudGVzdCBzb3VyY2VGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGtsb2cgJ2lnbm9yZT8nIGlcbiAgICAgICAgdHJ1ZVxuXG4gICAgaWYgbm90IGdpdGNvdW50XG4gICAgICAgIGdpdHVwID0gc2xhc2gucGFyc2UgYXJnRGlyKClcbiAgICAgICAgd2hpbGUgZ2l0dXAuYmFzZVxuICAgICAgICAgICAgZG90R2l0ID0gc2xhc2guam9pbiBnaXR1cC5kaXIsICcuZ2l0J1xuICAgICAgICAgICAgaWYgZnMuZXhpc3RzU3luYyBkb3RHaXRcbiAgICAgICAgICAgICAgICBpZiBhcmdzLmZldGNoXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cy5naXRGZXRjaCBkb3RHaXRcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1cy5naXRTdGF0dXMgZG90R2l0XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIGdpdHVwID0gc2xhc2gucGFyc2UgZ2l0dXAuZGlyXG4gICAgICAgICAgICBcbiMgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwXG4jIDAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMFxuIyAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwXG5cbmlmIGFyZ3MucnVuIG9yIGFyZ3MucmVidWlsZFxuXG4gICAgaWYgbm90IGFyZ3MucXVpZXRcbiAgICAgICAgbG9nICfwn5Sn8J+UpyAnICsgKGFyZ3MucmVidWlsZCBhbmQgJ3JlYnVpbGQnIG9yICdydW4nKS5ncmF5XG4gICAgXG4gICAgd2FsayB3bGssIG9wdCwgKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUpIC0+XG4gICAgICAgIGlmIHRhcmdldEZpbGVcbiAgICAgICAgICAgIGlzRGlydHkgPSBkaXJ0eSBzb3VyY2VGaWxlLCB0YXJnZXRGaWxlXG4gICAgICAgICAgICBpZiBhcmdzLnJlYnVpbGQgb3IgaXNEaXJ0eVxuICAgICAgICAgICAgICAgIHNyYyA9IHByZXR0eS5maWxlUGF0aChfLnBhZEVuZChzbGFzaC5yZWxhdGl2ZShzb3VyY2VGaWxlLCBhcmdEaXIoKSksIDQwKSwgaXNEaXJ0eSBhbmQgY29sb3JzLnJlZCBvciBjb2xvcnMueWVsbG93KVxuICAgICAgICAgICAgICAgIHRndCA9IHByZXR0eS5maWxlUGF0aChzbGFzaC5yZWxhdGl2ZSh0YXJnZXRGaWxlLCBhcmdEaXIoKSksIGNvbG9ycy5ncmVlbilcbiAgICAgICAgICAgICAgICBpZiBub3QgYXJncy5xdWlldFxuICAgICAgICAgICAgICAgICAgICBsb2cgc3JjLCBcIvCflKcgIFwiLCB0Z3RcbiAgICAgICAgICAgICAgICBidWlsZCBzb3VyY2VGaWxlLCBvcHQsIChzb3VyY2VGaWxlLCB0YXJnZXRGaWxlKSAtPlxuICAgICAgICAgICAgICAgICAgICBpZiBub3QgdGFyZ2V0RmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0IDFcbiAgICAgICAgICAgICAgICAgICAgbyA9IGNvbmZpZy5vYmogdGFyZ2V0RmlsZSwgb3B0XG4gICAgICAgICAgICAgICAgICAgIGlmIHNob3VsZCAnYnJvd3NlcmlmeScsIG8sIHRhcmdldEZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nIHByZXR0eS5maWxlUGF0aChfLnBhZEVuZChzbGFzaC5yZWxhdGl2ZShvLmJyb3dzZXJpZnkubWFpbiwgYXJnRGlyKCkpLCA0MCksIGNvbG9ycy55ZWxsb3cpLCBcIvCflKcgIFwiLCBwcmV0dHkuZmlsZVBhdGgoc2xhc2gucmVsYXRpdmUoby5icm93c2VyaWZ5Lm91dCwgYXJnRGlyKCkpLCBjb2xvcnMuYmx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bmNtZCAnYnJvd3NlcmlmeScgXCIje28uYnJvd3NlcmlmeS5tYWlufSAje28uYnJvd3NlcmlmeS5vdXR9XCIgY29uZmlnLnBhdGggJ2Jyb3dzZXJpZnknLCBzbGFzaC5yZXNvbHZlKHRhcmdldEZpbGUpLCBvcHRcblxuZm9yIGNtZCBpbiBbJ3VwZGF0ZScgJ2J1bXAnICdidWlsZCcgJ2NvbW1pdCcgJ3B1Ymxpc2gnICd0ZXN0J11cblxuICAgIGlmIGFyZ3NbY21kXVxuXG4gICAgICAgIGlmIG5vdCBydW5jbWQgY21kLCBhcmdzLmFyZ3VtZW50cy5qb2luKCcgJyksIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCAxXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgIGxvZyAn8J+UpyAgZG9uZScuZ3JheSBpZiBhcmdzLnZlcmJvc2VcblxuICAgICAgICBpZiBhcmdzLmFyZ3VtZW50cyBhbmQgY21kIGluIFsnY29tbWl0JyAnYnVtcCcgJ2J1aWxkJ11cbiAgICAgICAgICAgIGJyZWFrXG5cbmlmIGFyZ3Mud2F0Y2hcbiAgICB3YXRjaCB3bGssIG9wdFxuZWxzZSBpZiBjbWQgaW4gWydidWlsZCddXG4gICAgcHJvY2Vzcy5leGl0IDBcbiAgICAiXX0=
//# sourceURL=../coffee/konrad.coffee