/*
0000000    000   000  000  000      0000000  
000   000  000   000  000  000      000   000
0000000    000   000  000  000      000   000
000   000  000   000  000  000      000   000
0000000     0000000   000  0000000  0000000  
*/
var _, argDir, args, build, colors, compile, config, empty, error, fs, log, pretty, runcmd, should, slash, str, target, writeCompiled;

({args, slash, empty, fs, colors, str, error, _} = require('kxk'));

log = console.log;

pretty = require('./pretty');

config = require('./config');

argDir = require('./argdir');

should = require('./should');

target = require('./target');

compile = require('./compile');

runcmd = require('./runcmd');

build = function(sourceFile, opt, cb) {
  var cfg, ext, main, out, pwd, targetFile;
  if (args.debug) {
    log("source file".gray, sourceFile);
  }
  ext = slash.extname(sourceFile).substr(1);
  cfg = config.obj(sourceFile, opt);
  if (ext === 'js' && should('browserify', cfg, sourceFile)) {
    main = cfg.browserify.main;
    out = cfg.browserify.out;
    pwd = config.path('browserify', slash.resolve(sourceFile), opt);
    if (out !== slash.relative(sourceFile, pwd)) {
      log(pretty.filePath(_.padEnd(slash.relative(main, argDir()), 40), colors.yellow), "üîß  ", pretty.filePath(slash.relative(out, argDir()), colors.blue));
      runcmd('browserify', `${main} ${out}`, pwd);
    }
    return;
  }
  targetFile = target(sourceFile, opt);
  if (targetFile == null) {
    log(`no targetFile for source: ${sourceFile}`, opt);
    return;
  }
  if (args.debug) {
    log("target file".gray, targetFile);
  }
  // 00000000   00000000   0000000   0000000
  // 000   000  000       000   000  000   000
  // 0000000    0000000   000000000  000   000
  // 000   000  000       000   000  000   000
  // 000   000  00000000  000   000  0000000
  return fs.readFile(sourceFile, 'utf8', function(err, sourceText) {
    var compiled;
    if (err) {
      return error(`can't read ${sourceFile}`);
    }
    
    //  0000000   0000000   00     00  00000000   000  000      00000000  
    // 000       000   000  000   000  000   000  000  000      000       
    // 000       000   000  000000000  00000000   000  000      0000000   
    // 000       000   000  000 0 000  000        000  000      000       
    //  0000000   0000000   000   000  000        000  0000000  00000000  
    compiled = compile(sourceText, ext, sourceFile, targetFile, cfg);
    if (empty(compiled)) {
      if (args.verbose) {
        error(`compile failed for ${sourceFile}`);
      }
      return;
    }
    return fs.readFile(targetFile, 'utf8', function(err, targetData) {
      var stat, ttat;
      if (err || compiled !== targetData) {
        return writeCompiled(sourceFile, targetFile, compiled, cb);
      } else {
        if (args.debug) {
          log('unchanged'.green.dim, pretty.filePath(slash.relative(targetFile, argDir()), colors.gray));
        }
        if (args.verbose) {
          log(pretty.time(), `üëç  ${pretty.filePath(sourceFile)} ${'‚ñ∫'.bold.yellow} ${pretty.filePath(targetFile)}`);
        }
        stat = fs.statSync(sourceFile);
        ttat = fs.statSync(targetFile);
        if (stat.mtime.getTime() !== ttat.mtime.getTime()) {
          return fs.utimesSync(slash.resolve(targetFile), stat.atime, stat.mtime);
        }
      }
    });
  });
};

// 000   000  00000000   000  000000000  00000000
// 000 0 000  000   000  000     000     000
// 000000000  0000000    000     000     0000000
// 000   000  000   000  000     000     000
// 00     00  000   000  000     000     00000000
writeCompiled = function(sourceFile, targetFile, compiled, cb) {
  if (args.debug) {
    log('writeCompiled:', sourceFile, targetFile);
  }
  return fs.ensureDir(slash.dir(targetFile), function(err) {
    if (err) {
      return error(`can't create output  directory${slash.dir(targetFile)}`);
    }
    return fs.writeFile(targetFile, compiled, function(err) {
      if (!empty(err)) {
        return error(`can't  write${targetFile}!`, err);
      }
      if (!args.quiet) {
        if (args.verbose) {
          log(pretty.time(), `üëç   ${pretty.filePath(slash.tilde(sourceFile))} ${'‚ñ∫'.bold.yellow} ${pretty.filePath(slash.tilde(targetFile))}`);
        } else {
          log(pretty.time(), `üëç   ${pretty.filePath(slash.tilde(targetFile))}`);
        }
      }
      return typeof cb === "function" ? cb(sourceFile, targetFile) : void 0;
    });
  });
};

module.exports = build;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL2J1aWxkLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUFBLElBQUEsQ0FBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQSxFQUFBLE1BQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxFQUFBLE1BQUEsRUFBQTs7QUFRQSxDQUFBLENBQUUsSUFBRixFQUFRLEtBQVIsRUFBZSxLQUFmLEVBQXNCLEVBQXRCLEVBQTBCLE1BQTFCLEVBQWtDLEdBQWxDLEVBQXVDLEtBQXZDLEVBQThDLENBQTlDLENBQUEsR0FBb0QsT0FBQSxDQUFRLEtBQVIsQ0FBcEQ7O0FBRUEsR0FBQSxHQUFVLE9BQU8sQ0FBQzs7QUFDbEIsTUFBQSxHQUFVLE9BQUEsQ0FBUSxVQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFDVixNQUFBLEdBQVUsT0FBQSxDQUFRLFVBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxVQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFDVixPQUFBLEdBQVUsT0FBQSxDQUFRLFdBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxVQUFSOztBQUVWLEtBQUEsR0FBUSxRQUFBLENBQUMsVUFBRCxFQUFhLEdBQWIsRUFBa0IsRUFBbEIsQ0FBQTtBQUVKLE1BQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQTtFQUFBLElBQXNDLElBQUksQ0FBQyxLQUEzQztJQUFBLEdBQUEsQ0FBSSxhQUFhLENBQUMsSUFBbEIsRUFBd0IsVUFBeEIsRUFBQTs7RUFFQSxHQUFBLEdBQU0sS0FBSyxDQUFDLE9BQU4s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Q0FBQyxHQUFELENBQUE7TUFDL0IsSUFBRyxDQUFJLEtBQUEsQ0FBTSxHQUFOLENBQVA7QUFDSSxlQUFPLEtBQUEsQ0FBTSxDQUFBLFlBQUEsQ0FBQSxDQUFlLFVBQWYsQ0FBMEIsQ0FBMUIsQ0FBTixFQUFvQyxHQUFwQyxFQURYOztNQUVBLElBQUcsQ0FBSSxJQUFJLENBQUMsS0FBWjtRQUNJLElBQUcsSUFBSSxDQUFDLE9BQVI7VUFDSSxHQUFBLENBQUksTUFBTSxDQUFDLElBQVAsQ0FBQSxDQUFKLEVBQW1CLENBQUEsS0FBQSxDQUFBLENBQVEsTUFBTSxDQUFDLFFBQVAsQ0FBZ0IsS0FBSyxDQUFDLEtBQU4sQ0FBWSxVQUFaLENBQWhCLENBQVIsRUFBQSxDQUFBLENBQWtELEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBM0QsRUFBQSxDQUFBLENBQXFFLE1BQU0sQ0FBQyxRQUFQLENBQWdCLEtBQUssQ0FBQyxLQUFOLENBQVksVUFBWixDQUFoQixDQUFyRSxDQUFBLENBQW5CLEVBREo7U0FBQSxNQUFBO1VBR0ksR0FBQSxDQUFJLE1BQU0sQ0FBQyxJQUFQLENBQUEsQ0FBSixFQUFtQixDQUFBLEtBQUEsQ0FBQSxDQUFRLE1BQU0sQ0FBQyxRQUFQLENBQWdCLEtBQUssQ0FBQyxLQUFOLENBQVksVUFBWixDQUFoQixDQUFSLENBQUEsQ0FBbkIsRUFISjtTQURKOzt3Q0FNQSxHQUFJLFlBQVk7SUFUZSxDQUFuQztFQUpnQyxDQUFwQztBQUpZOztBQW1CaEIsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgIFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwXG4wMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAgICAwMDAgICAwMDBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMFxuMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMCAgXG4jIyNcblxueyBhcmdzLCBzbGFzaCwgZW1wdHksIGZzLCBjb2xvcnMsIHN0ciwgZXJyb3IsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxubG9nICAgICA9IGNvbnNvbGUubG9nXG5wcmV0dHkgID0gcmVxdWlyZSAnLi9wcmV0dHknXG5jb25maWcgID0gcmVxdWlyZSAnLi9jb25maWcnXG5hcmdEaXIgID0gcmVxdWlyZSAnLi9hcmdkaXInXG5zaG91bGQgID0gcmVxdWlyZSAnLi9zaG91bGQnXG50YXJnZXQgID0gcmVxdWlyZSAnLi90YXJnZXQnXG5jb21waWxlID0gcmVxdWlyZSAnLi9jb21waWxlJ1xucnVuY21kICA9IHJlcXVpcmUgJy4vcnVuY21kJ1xuXG5idWlsZCA9IChzb3VyY2VGaWxlLCBvcHQsIGNiKSAtPlxuXG4gICAgbG9nIFwic291cmNlIGZpbGVcIi5ncmF5LCBzb3VyY2VGaWxlIGlmIGFyZ3MuZGVidWdcblxuICAgIGV4dCA9IHNsYXNoLmV4dG5hbWUoc291cmNlRmlsZSkuc3Vic3RyKDEpXG5cbiAgICBjZmcgPSBjb25maWcub2JqIHNvdXJjZUZpbGUsIG9wdFxuXG4gICAgaWYgZXh0ID09ICdqcycgYW5kIHNob3VsZCAnYnJvd3NlcmlmeScsIGNmZywgc291cmNlRmlsZVxuICAgICAgICBtYWluID0gY2ZnLmJyb3dzZXJpZnkubWFpblxuICAgICAgICBvdXQgID0gY2ZnLmJyb3dzZXJpZnkub3V0XG4gICAgICAgIHB3ZCAgPSBjb25maWcucGF0aCAnYnJvd3NlcmlmeScsIHNsYXNoLnJlc29sdmUoc291cmNlRmlsZSksIG9wdFxuICAgICAgICBpZiBvdXQgIT0gc2xhc2gucmVsYXRpdmUgc291cmNlRmlsZSwgcHdkXG4gICAgICAgICAgICBsb2cgcHJldHR5LmZpbGVQYXRoKF8ucGFkRW5kKHNsYXNoLnJlbGF0aXZlKG1haW4sIGFyZ0RpcigpKSwgNDApLCBjb2xvcnMueWVsbG93KSwgXCLwn5SnICBcIiwgcHJldHR5LmZpbGVQYXRoKHNsYXNoLnJlbGF0aXZlKG91dCwgYXJnRGlyKCkpLCBjb2xvcnMuYmx1ZSlcbiAgICAgICAgICAgIHJ1bmNtZCAnYnJvd3NlcmlmeScsIFwiI3ttYWlufSAje291dH1cIiwgcHdkXG4gICAgICAgIHJldHVyblxuXG4gICAgdGFyZ2V0RmlsZSA9IHRhcmdldCBzb3VyY2VGaWxlLCBvcHRcbiAgICBpZiBub3QgdGFyZ2V0RmlsZT9cbiAgICAgICAgbG9nIFwibm8gdGFyZ2V0RmlsZSBmb3Igc291cmNlOiAje3NvdXJjZUZpbGV9XCIsIG9wdFxuICAgICAgICByZXR1cm5cblxuICAgIGxvZyBcInRhcmdldCBmaWxlXCIuZ3JheSwgdGFyZ2V0RmlsZSBpZiBhcmdzLmRlYnVnXG5cbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwXG5cbiAgICBmcy5yZWFkRmlsZSBzb3VyY2VGaWxlLCAndXRmOCcsIChlcnIsIHNvdXJjZVRleHQpIC0+XG5cbiAgICAgICAgaWYgZXJyIHRoZW4gcmV0dXJuIGVycm9yIFwiY2FuJ3QgcmVhZCAje3NvdXJjZUZpbGV9XCJcbiAgICAgICAgXG4gICAgICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAgICAgIDAwICAwMDAwMDAwMCAgIDAwMCAgMDAwICAgICAgMDAwMDAwMDAgIFxuICAgICAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMCAgICAgICBcbiAgICAgICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwICAwMDAgICAgICAwMDAwMDAwICAgXG4gICAgICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAgICAgXG4gICAgICAgIGNvbXBpbGVkID0gY29tcGlsZSBzb3VyY2VUZXh0LCBleHQsIHNvdXJjZUZpbGUsIHRhcmdldEZpbGUsIGNmZ1xuICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgY29tcGlsZWRcbiAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZSB0aGVuIGVycm9yIFwiY29tcGlsZSBmYWlsZWQgZm9yICN7c291cmNlRmlsZX1cIlxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBmcy5yZWFkRmlsZSB0YXJnZXRGaWxlLCAndXRmOCcsIChlcnIsIHRhcmdldERhdGEpIC0+XG5cbiAgICAgICAgICAgIGlmIGVyciBvciBjb21waWxlZCAhPSB0YXJnZXREYXRhXG5cbiAgICAgICAgICAgICAgICB3cml0ZUNvbXBpbGVkIHNvdXJjZUZpbGUsIHRhcmdldEZpbGUsIGNvbXBpbGVkLCBjYlxuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgbG9nICd1bmNoYW5nZWQnLmdyZWVuLmRpbSwgcHJldHR5LmZpbGVQYXRoKHNsYXNoLnJlbGF0aXZlKHRhcmdldEZpbGUsIGFyZ0RpcigpKSwgY29sb3JzLmdyYXkpIGlmIGFyZ3MuZGVidWdcbiAgICAgICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2VcbiAgICAgICAgICAgICAgICAgICAgbG9nIHByZXR0eS50aW1lKCksIFwi8J+RjSAgI3twcmV0dHkuZmlsZVBhdGggc291cmNlRmlsZX0gI3sn4pa6Jy5ib2xkLnllbGxvd30gI3twcmV0dHkuZmlsZVBhdGggdGFyZ2V0RmlsZX1cIlxuICAgICAgICAgICAgICAgIHN0YXQgPSBmcy5zdGF0U3luYyBzb3VyY2VGaWxlXG4gICAgICAgICAgICAgICAgdHRhdCA9IGZzLnN0YXRTeW5jIHRhcmdldEZpbGVcbiAgICAgICAgICAgICAgICBpZiBzdGF0Lm10aW1lLmdldFRpbWUoKSAhPSB0dGF0Lm10aW1lLmdldFRpbWUoKVxuICAgICAgICAgICAgICAgICAgICBmcy51dGltZXNTeW5jIHNsYXNoLnJlc29sdmUodGFyZ2V0RmlsZSksIHN0YXQuYXRpbWUsIHN0YXQubXRpbWVcblxuIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwXG4jIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgMDAwXG4jIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMFxuIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMFxuIyAwMCAgICAgMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwXG5cbndyaXRlQ29tcGlsZWQgPSAoc291cmNlRmlsZSwgdGFyZ2V0RmlsZSwgY29tcGlsZWQsIGNiKSAtPlxuXG4gICAgbG9nICd3cml0ZUNvbXBpbGVkOicsIHNvdXJjZUZpbGUsIHRhcmdldEZpbGUgaWYgYXJncy5kZWJ1Z1xuICAgIFxuICAgIGZzLmVuc3VyZURpciBzbGFzaC5kaXIodGFyZ2V0RmlsZSksIChlcnIpIC0+XG5cbiAgICAgICAgaWYgZXJyIHRoZW4gcmV0dXJuIGVycm9yIFwiY2FuJ3QgY3JlYXRlIG91dHB1dCAgZGlyZWN0b3J5I3tzbGFzaC5kaXIodGFyZ2V0RmlsZSl9XCJcblxuICAgICAgICBmcy53cml0ZUZpbGUgdGFyZ2V0RmlsZSwgY29tcGlsZWQsIChlcnIpIC0+XG4gICAgICAgICAgICBpZiBub3QgZW1wdHkgZXJyIFxuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvciBcImNhbid0ICB3cml0ZSN7dGFyZ2V0RmlsZX0hXCIsIGVyclxuICAgICAgICAgICAgaWYgbm90IGFyZ3MucXVpZXRcbiAgICAgICAgICAgICAgICBpZiBhcmdzLnZlcmJvc2VcbiAgICAgICAgICAgICAgICAgICAgbG9nIHByZXR0eS50aW1lKCksIFwi8J+RjSAgICN7cHJldHR5LmZpbGVQYXRoIHNsYXNoLnRpbGRlIHNvdXJjZUZpbGV9ICN7J+KWuicuYm9sZC55ZWxsb3d9ICN7cHJldHR5LmZpbGVQYXRoIHNsYXNoLnRpbGRlIHRhcmdldEZpbGV9XCJcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGxvZyBwcmV0dHkudGltZSgpLCBcIvCfkY0gICAje3ByZXR0eS5maWxlUGF0aCBzbGFzaC50aWxkZSB0YXJnZXRGaWxlfVwiXG5cbiAgICAgICAgICAgIGNiPyBzb3VyY2VGaWxlLCB0YXJnZXRGaWxlXG5cbm1vZHVsZS5leHBvcnRzID0gYnVpbGRcbiJdfQ==
//# sourceURL=../coffee/build.coffee