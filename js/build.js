// koffee 1.3.0

/*
0000000    000   000  000  000      0000000  
000   000  000   000  000  000      000   000
0000000    000   000  000  000      000   000
000   000  000   000  000  000      000   000
0000000     0000000   000  0000000  0000000
 */
var _, argDir, args, atomic, build, colors, compile, config, empty, fs, kerror, klog, pretty, ref, runcmd, should, slash, target, writeCompiled;

ref = require('kxk'), args = ref.args, slash = ref.slash, atomic = ref.atomic, empty = ref.empty, fs = ref.fs, colors = ref.colors, klog = ref.klog, kerror = ref.kerror, _ = ref._;

pretty = require('./pretty');

config = require('./config');

argDir = require('./argdir');

should = require('./should');

target = require('./target');

compile = require('./compile');

runcmd = require('./runcmd');

build = function(sourceFile, opt, cb) {
    var cfg, ext, main, out, pwd, targetFile;
    if (args.debug) {
        klog("source file".gray, sourceFile);
    }
    ext = slash.extname(sourceFile).substr(1);
    cfg = config.obj(sourceFile, opt);
    if (ext === 'js' && should('browserify', cfg, sourceFile)) {
        main = cfg.browserify.main;
        out = cfg.browserify.out;
        pwd = config.path('browserify', slash.resolve(sourceFile), opt);
        if (out !== slash.relative(sourceFile, pwd)) {
            klog(pretty.filePath(_.padEnd(slash.relative(main, argDir()), 40), colors.yellow), "üîß  ", pretty.filePath(slash.relative(out, argDir()), colors.blue));
            runcmd('browserify', main + " " + out, pwd);
        }
        return;
    }
    targetFile = target(sourceFile, opt);
    if (targetFile == null) {
        console.warn("no targetFile for source: " + sourceFile, opt);
        return;
    }
    if (args.debug) {
        klog("target file".gray, targetFile);
    }
    return fs.readFile(sourceFile, 'utf8', function(err, sourceText) {
        var compiled;
        if (err) {
            kerror("can't read " + sourceFile);
            cb();
            return;
        }
        compiled = compile(sourceText, ext, sourceFile, targetFile, cfg);
        if (empty(compiled)) {
            cb();
            return;
        }
        return fs.readFile(targetFile, 'utf8', function(err, targetData) {
            var stat, ttat;
            if (err || compiled !== targetData) {
                return writeCompiled(sourceFile, targetFile, compiled, cb);
            } else {
                if (args.debug) {
                    klog('unchanged'.green.dim, pretty.filePath(slash.relative(targetFile, argDir()), colors.gray));
                }
                if (args.verbose) {
                    console.log(pretty.time(), "üëç  " + (pretty.filePath(sourceFile)) + " " + '‚ñ∫'.bold.yellow + " " + (pretty.filePath(targetFile)));
                }
                stat = fs.statSync(sourceFile);
                ttat = fs.statSync(targetFile);
                if (stat.mtime.getTime() !== ttat.mtime.getTime()) {
                    return fs.utimesSync(slash.resolve(targetFile), stat.atime, stat.mtime);
                }
            }
        });
    });
};

writeCompiled = function(sourceFile, targetFile, compiled, cb) {
    return fs.ensureDir(slash.dir(targetFile), function(err) {
        if (err) {
            return kerror("can't create output  directory" + (slash.dir(targetFile)));
        }
        return slash.writeText(targetFile, compiled, function(file) {
            if (empty(file)) {
                return kerror(("can't write text file " + targetFile + "!").bold.red);
            }
            if (!args.quiet) {
                if (args.verbose) {
                    klog(pretty.time(), "üëç   " + (pretty.filePath(slash.tilde(sourceFile))) + " " + '‚ñ∫'.bold.yellow + " " + (pretty.filePath(slash.tilde(targetFile))));
                } else {
                    klog(pretty.time(), "üëç   " + (pretty.filePath(slash.tilde(targetFile))));
                }
            }
            return typeof cb === "function" ? cb(sourceFile, targetFile) : void 0;
        });
    });
};

module.exports = build;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBOztBQVFBLE1BQThELE9BQUEsQ0FBUSxLQUFSLENBQTlELEVBQUUsZUFBRixFQUFRLGlCQUFSLEVBQWUsbUJBQWYsRUFBdUIsaUJBQXZCLEVBQThCLFdBQTlCLEVBQWtDLG1CQUFsQyxFQUEwQyxlQUExQyxFQUFnRCxtQkFBaEQsRUFBd0Q7O0FBRXhELE1BQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFDVixNQUFBLEdBQVUsT0FBQSxDQUFRLFVBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxVQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFDVixNQUFBLEdBQVUsT0FBQSxDQUFRLFVBQVI7O0FBQ1YsT0FBQSxHQUFVLE9BQUEsQ0FBUSxXQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFFVixLQUFBLEdBQVEsU0FBQyxVQUFELEVBQWEsR0FBYixFQUFrQixFQUFsQjtBQUVKLFFBQUE7SUFBQSxJQUF1QyxJQUFJLENBQUMsS0FBNUM7UUFBQSxJQUFBLENBQUssYUFBYSxDQUFDLElBQW5CLEVBQXlCLFVBQXpCLEVBQUE7O0lBRUEsR0FBQSxHQUFNLEtBQUssQ0FBQyxPQUFOLENBQWMsVUFBZCxDQUF5QixDQUFDLE1BQTFCLENBQWlDLENBQWpDO0lBRU4sR0FBQSxHQUFNLE1BQU0sQ0FBQyxHQUFQLENBQVcsVUFBWCxFQUF1QixHQUF2QjtJQUVOLElBQUcsR0FBQSxLQUFPLElBQVAsSUFBZ0IsTUFBQSxDQUFPLFlBQVAsRUFBcUIsR0FBckIsRUFBMEIsVUFBMUIsQ0FBbkI7UUFDSSxJQUFBLEdBQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQztRQUN0QixHQUFBLEdBQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQztRQUN0QixHQUFBLEdBQU8sTUFBTSxDQUFDLElBQVAsQ0FBWSxZ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Q0FBZ0IsS0FBSyxDQUFDLEtBQU4sQ0FBWSxVQUFaLENBQWhCLENBQUQsQ0FBM0IsRUFISjtpQkFESjs7OENBTUEsR0FBSSxZQUFZO1FBVGtCLENBQXRDO0lBSmdDLENBQXBDO0FBSlk7O0FBbUJoQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMCAgICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAgICAwMDAgICAwMDBcbjAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwXG4wMDAwMDAwICAgICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICBcbiMjI1xuXG57IGFyZ3MsIHNsYXNoLCBhdG9taWMsIGVtcHR5LCBmcywgY29sb3JzLCBrbG9nLCBrZXJyb3IsIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxucHJldHR5ICA9IHJlcXVpcmUgJy4vcHJldHR5J1xuY29uZmlnICA9IHJlcXVpcmUgJy4vY29uZmlnJ1xuYXJnRGlyICA9IHJlcXVpcmUgJy4vYXJnZGlyJ1xuc2hvdWxkICA9IHJlcXVpcmUgJy4vc2hvdWxkJ1xudGFyZ2V0ICA9IHJlcXVpcmUgJy4vdGFyZ2V0J1xuY29tcGlsZSA9IHJlcXVpcmUgJy4vY29tcGlsZSdcbnJ1bmNtZCAgPSByZXF1aXJlICcuL3J1bmNtZCdcblxuYnVpbGQgPSAoc291cmNlRmlsZSwgb3B0LCBjYikgLT5cblxuICAgIGtsb2cgXCJzb3VyY2UgZmlsZVwiLmdyYXksIHNvdXJjZUZpbGUgaWYgYXJncy5kZWJ1Z1xuXG4gICAgZXh0ID0gc2xhc2guZXh0bmFtZShzb3VyY2VGaWxlKS5zdWJzdHIoMSlcblxuICAgIGNmZyA9IGNvbmZpZy5vYmogc291cmNlRmlsZSwgb3B0XG5cbiAgICBpZiBleHQgPT0gJ2pzJyBhbmQgc2hvdWxkICdicm93c2VyaWZ5JywgY2ZnLCBzb3VyY2VGaWxlXG4gICAgICAgIG1haW4gPSBjZmcuYnJvd3NlcmlmeS5tYWluXG4gICAgICAgIG91dCAgPSBjZmcuYnJvd3NlcmlmeS5vdXRcbiAgICAgICAgcHdkICA9IGNvbmZpZy5wYXRoICdicm93c2VyaWZ5Jywgc2xhc2gucmVzb2x2ZShzb3VyY2VGaWxlKSwgb3B0XG4gICAgICAgIGlmIG91dCAhPSBzbGFzaC5yZWxhdGl2ZSBzb3VyY2VGaWxlLCBwd2RcbiAgICAgICAgICAgIGtsb2cgcHJldHR5LmZpbGVQYXRoKF8ucGFkRW5kKHNsYXNoLnJlbGF0aXZlKG1haW4sIGFyZ0RpcigpKSwgNDApLCBjb2xvcnMueWVsbG93KSwgXCLwn5SnICBcIiwgcHJldHR5LmZpbGVQYXRoKHNsYXNoLnJlbGF0aXZlKG91dCwgYXJnRGlyKCkpLCBjb2xvcnMuYmx1ZSlcbiAgICAgICAgICAgIHJ1bmNtZCAnYnJvd3NlcmlmeScsIFwiI3ttYWlufSAje291dH1cIiwgcHdkXG4gICAgICAgIHJldHVyblxuXG4gICAgdGFyZ2V0RmlsZSA9IHRhcmdldCBzb3VyY2VGaWxlLCBvcHRcbiAgICBpZiBub3QgdGFyZ2V0RmlsZT9cbiAgICAgICAgd2FybiBcIm5vIHRhcmdldEZpbGUgZm9yIHNvdXJjZTogI3tzb3VyY2VGaWxlfVwiLCBvcHRcbiAgICAgICAgcmV0dXJuXG5cbiAgICBrbG9nIFwidGFyZ2V0IGZpbGVcIi5ncmF5LCB0YXJnZXRGaWxlIGlmIGFyZ3MuZGVidWdcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDBcblxuICAgIGZzLnJlYWRGaWxlIHNvdXJjZUZpbGUsICd1dGY4JywgKGVyciwgc291cmNlVGV4dCkgLT5cblxuICAgICAgICBpZiBlcnIgXG4gICAgICAgICAgICBrZXJyb3IgXCJjYW4ndCByZWFkICN7c291cmNlRmlsZX1cIlxuICAgICAgICAgICAgY2IoKVxuICAgICAgICAgICAgcmV0dXJuIFxuICAgICAgICBcbiAgICAgICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMCAgICAgMDAgIDAwMDAwMDAwICAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgXG4gICAgICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICBcbiAgICAgICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgXG4gICAgICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICAgICBcbiAgICAgICAgY29tcGlsZWQgPSBjb21waWxlIHNvdXJjZVRleHQsIGV4dCwgc291cmNlRmlsZSwgdGFyZ2V0RmlsZSwgY2ZnXG4gICAgICAgIFxuICAgICAgICBpZiBlbXB0eSBjb21waWxlZFxuICAgICAgICAgICAgY2IoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBmcy5yZWFkRmlsZSB0YXJnZXRGaWxlLCAndXRmOCcsIChlcnIsIHRhcmdldERhdGEpIC0+XG5cbiAgICAgICAgICAgIGlmIGVyciBvciBjb21waWxlZCAhPSB0YXJnZXREYXRhXG5cbiAgICAgICAgICAgICAgICB3cml0ZUNvbXBpbGVkIHNvdXJjZUZpbGUsIHRhcmdldEZpbGUsIGNvbXBpbGVkLCBjYlxuXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAga2xvZyAndW5jaGFuZ2VkJy5ncmVlbi5kaW0sIHByZXR0eS5maWxlUGF0aChzbGFzaC5yZWxhdGl2ZSh0YXJnZXRGaWxlLCBhcmdEaXIoKSksIGNvbG9ycy5ncmF5KSBpZiBhcmdzLmRlYnVnXG4gICAgICAgICAgICAgICAgaWYgYXJncy52ZXJib3NlXG4gICAgICAgICAgICAgICAgICAgIGxvZyBwcmV0dHkudGltZSgpLCBcIvCfkY0gICN7cHJldHR5LmZpbGVQYXRoIHNvdXJjZUZpbGV9ICN7J+KWuicuYm9sZC55ZWxsb3d9ICN7cHJldHR5LmZpbGVQYXRoIHRhcmdldEZpbGV9XCJcbiAgICAgICAgICAgICAgICBzdGF0ID0gZnMuc3RhdFN5bmMgc291cmNlRmlsZVxuICAgICAgICAgICAgICAgIHR0YXQgPSBmcy5zdGF0U3luYyB0YXJnZXRGaWxlXG4gICAgICAgICAgICAgICAgaWYgc3RhdC5tdGltZS5nZXRUaW1lKCkgIT0gdHRhdC5tdGltZS5nZXRUaW1lKClcbiAgICAgICAgICAgICAgICAgICAgZnMudXRpbWVzU3luYyBzbGFzaC5yZXNvbHZlKHRhcmdldEZpbGUpLCBzdGF0LmF0aW1lLCBzdGF0Lm10aW1lXG5cbiMgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMFxuIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIDAwMFxuIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDBcbiMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDBcbiMgMDAgICAgIDAwICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMFxuXG53cml0ZUNvbXBpbGVkID0gKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUsIGNvbXBpbGVkLCBjYikgLT5cblxuICAgICMga2xvZyAnd3JpdGVDb21waWxlZDonLCBzb3VyY2VGaWxlLCB0YXJnZXRGaWxlIGlmIGFyZ3MuZGVidWdcbiAgICBcbiAgICBmcy5lbnN1cmVEaXIgc2xhc2guZGlyKHRhcmdldEZpbGUpLCAoZXJyKSAtPlxuXG4gICAgICAgIGlmIGVyciB0aGVuIHJldHVybiBrZXJyb3IgXCJjYW4ndCBjcmVhdGUgb3V0cHV0ICBkaXJlY3Rvcnkje3NsYXNoLmRpcih0YXJnZXRGaWxlKX1cIlxuXG4gICAgICAgIHNsYXNoLndyaXRlVGV4dCB0YXJnZXRGaWxlLCBjb21waWxlZCwgKGZpbGUpIC0+XG4gICAgICAgICAgICBpZiBlbXB0eSBmaWxlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGtlcnJvciBcImNhbid0IHdyaXRlIHRleHQgZmlsZSAje3RhcmdldEZpbGV9IVwiLmJvbGQucmVkXG4gICAgICAgICAgICBpZiBub3QgYXJncy5xdWlldFxuICAgICAgICAgICAgICAgIGlmIGFyZ3MudmVyYm9zZVxuICAgICAgICAgICAgICAgICAgICBrbG9nIHByZXR0eS50aW1lKCksIFwi8J+RjSAgICN7cHJldHR5LmZpbGVQYXRoIHNsYXNoLnRpbGRlIHNvdXJjZUZpbGV9ICN7J+KWuicuYm9sZC55ZWxsb3d9ICN7cHJldHR5LmZpbGVQYXRoIHNsYXNoLnRpbGRlIHRhcmdldEZpbGV9XCJcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgcHJldHR5LnRpbWUoKSwgXCLwn5GNICAgI3twcmV0dHkuZmlsZVBhdGggc2xhc2gudGlsZGUgdGFyZ2V0RmlsZX1cIlxuXG4gICAgICAgICAgICBjYj8gc291cmNlRmlsZSwgdGFyZ2V0RmlsZVxuXG5tb2R1bGUuZXhwb3J0cyA9IGJ1aWxkXG4iXX0=
//# sourceURL=../coffee/build.coffee