#!/usr/bin/env bash
DIR=`dirname $0`
if [ $# -eq 0 ]; then
    if [ -e package.json ]; then
        MSG="v`sds -rp version`"
    elif [ -e ../package.json ]; then
        MSG="v`../node_modules/.bin/sds -rp version ../package.json`"
    fi
    if [ -z "$MSG" ]; then
        echo '[ERROR] no commit message and no package.json!' | $DIR/../node_modules/.bin/colorcat -sp "(\[)(.+)(\])(.*) . Rfr . Rfy . Rfr . fy" 
        exit 1
    fi
else
    MSG="$*"
fi

set -e

git add .
git status -sb       | $DIR/../node_modules/.bin/colorcat -sP $DIR/../cc/status.noon
git commit -m "$MSG" | $DIR/../node_modules/.bin/colorcat -sP $DIR/../cc/commit.noon

echo 'pushing'       | $DIR/../node_modules/.bin/colorcat -sx

git push -q 2>&1     | $DIR/../node_modules/.bin/colorcat -sP  $DIR/../cc/push.noon
git status -sb       | $DIR/../node_modules/.bin/colorcat -sP  $DIR/../cc/status.noon
